<!-- src/app/pages/transactions/transactions.component.html -->
<div class="transactions-page">
  <h1 class="page-title">ğŸ’³ Transaction Monitor</h1>

  <!-- Filter Form -->
  <div class="card form-card">
    <h3 class="form-title">ğŸ” Search Transactions</h3>
    <div class="form-grid">
      <label>
        <span>Customer ID</span>
        <input [(ngModel)]="customerId" placeholder="Enter Customer ID" />
      </label>
      <label>
        <span>From</span>
        <input type="date" [(ngModel)]="from" />
      </label>
      <label>
        <span>To</span>
        <input type="date" [(ngModel)]="to" />
      </label>
    </div>

    <div class="actions">
      <button class="btn search" (click)="fetchTransactions()">ğŸ” Search</button>
      <button class="btn show" (click)="fetchAllTransactions()">ğŸ“‹ Show All</button>
      <button
        class="btn warn"
        (click)="checkAllFraud()"
        [disabled]="transactions.length === 0"
      >
        âš ï¸ Check All
      </button>
      <button class="btn export" (click)="exportToExcel()">ğŸ“¤ Export</button>
    </div>
  </div>

  <p *ngIf="loading" class="muted">Loading transactions...</p>
  <p *ngIf="error" class="error">{{ error }}</p>

  <!-- Transactions Table -->
  <div *ngIf="transactions.length > 0" class="table-card card">
    <h3 class="subtitle">ğŸ“Š Transaction Summary</h3>
    <table class="txn-table">
      <thead>
        <tr>
          <th>Txn ID</th>
          <th>Amount</th>
          <th>Merchant</th>
          <th>MCC</th>
          <th>Timestamp</th>
          <th>Action</th>
          <th>Fraud Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let txn of transactions">
          <td>{{ txn.txnId }}</td>
          <td>â‚¹{{ txn.amount }}</td>
          <td>{{ txn.merchant }}</td>
          <td>{{ txn.mcc }}</td>
          <td>{{ txn.ts ? (txn.ts | date: 'medium') : '' }}</td>
          <td>
            <button class="btn small check" (click)="checkFraud(txn)">Check</button>
          </td>
          <td>
            <div *ngIf="fraudResults[txn.txnId]">
              <p
                [ngClass]="{
                  red: fraudResults[txn.txnId].fraudStatus === 'Fraudulent',
                  green: fraudResults[txn.txnId].fraudStatus !== 'Fraudulent'
                }"
              >
                {{
                  fraudResults[txn.txnId].fraudStatus === 'Fraudulent'
                    ? 'âš ï¸ Fraudulent'
                    : 'âœ… Clean'
                }}
              </p>
              <ul *ngIf="fraudResults[txn.txnId].triggeredRules?.length">
                <li *ngFor="let r of fraudResults[txn.txnId].triggeredRules">
                  {{ r }}
                </li>
              </ul>
            </div>
            <span *ngIf="!fraudResults[txn.txnId]" class="muted">â€“</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <p *ngIf="!loading && transactions.length === 0" class="muted no-data">
    No transactions found.
  </p>
</div>
